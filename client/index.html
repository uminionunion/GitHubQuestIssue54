
<!--
AI PROMPT TO RECREATE THIS FEATURE IN HTML, CSS, JS, SQL, PHP:

**Objective:** Create a comprehensive, single-page web application feature called "PantryFinder". This tool allows users to find various local resources (pantries, political representatives) on an interactive map and submit new pantry or candidate locations. The entire feature should operate within a large modal window triggered from the main page.

**Technology Stack:**
-   **Frontend:** Plain HTML5, CSS3, and JavaScript (ES6+). No frameworks.
-   **Mapping Library:** Leaflet.js.
-   **Backend:** PHP (latest stable version) for API endpoints.
-   **Database:** MySQL or MariaDB.

---

### **Part 1: Database Schema (SQL)**

Define three tables in your MySQL/MariaDB database.

1.  **`pantries` table:** Stores user-submitted pantry information.
    -   `id` (INT, PRIMARY KEY, AUTO_INCREMENT)
    -   `name` (VARCHAR(255), NOT NULL)
    -   `address` (VARCHAR(255), NOT NULL)
    -   `lat` (DECIMAL(10, 8), NOT NULL)
    -   `lng` (DECIMAL(11, 8), NOT NULL)
    -   `hours` (VARCHAR(255))
    -   `notes` (TEXT)
    -   `type` (ENUM('food', 'clothing', 'resource', 'library'), NOT NULL)
    -   `repeating` (ENUM('one-time', 'daily', 'weekly', 'weekendly', 'monthly', 'idk'), NOT NULL)
    -   `deleted` (BOOLEAN, DEFAULT 0) - Use this as a soft-delete flag. Entries with `deleted=1` should not be fetched by the API.
    -   `created_at` (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)

2.  **`politicians` table:** Stores data for political representatives.
    -   `id` (INT, PRIMARY KEY, AUTO_INCREMENT)
    -   `name` (VARCHAR(255), NOT NULL)
    -   `office` (ENUM('House', 'Senate'), NOT NULL)
    -   `state` (VARCHAR(2), NOT NULL)
    -   `district` (INT, NULL) - `NULL` for Senators.
    -   `party` (VARCHAR(50))
    -   `term_end_date` (DATE)
    -   `website` (VARCHAR(255), NULL)
    -   `lat` (DECIMAL(10, 8), NOT NULL)
    -   `lng` (DECIMAL(11, 8), NOT NULL)

3.  **`candidates` table:** Stores data for political candidates.
    -   `id` (INT, PRIMARY KEY, AUTO_INCREMENT)
    -   `name` (VARCHAR(255), NOT NULL)
    -   `office` (ENUM('House', 'Senate'), NOT NULL) - For pre-populated data.
    -   `state` (VARCHAR(255), NOT NULL)
    -   `district` (INT, NULL)
    -   `party` (VARCHAR(50))
    -   `website` (VARCHAR(255), NULL)
    -   `lat` (DECIMAL(10, 8), NOT NULL)
    -   `lng` (DECIMAL(11, 8), NOT NULL)
    -   `phone` (VARCHAR(50), NULL) - Optional, for union resources.
    -   `show_on_map` (BOOLEAN, DEFAULT 1) - To control visibility.
    -   `office_type` (VARCHAR(255), NULL) - For user submissions, e.g., 'State House'.
    -   `country` (VARCHAR(255), NULL) - For user submissions.

---

### **Part 2: Backend API (PHP)**

Create a directory named `api` to house the PHP scripts. All endpoints must handle Cross-Origin Resource Sharing (CORS) and return data in JSON format.

1.  **`data.php` (`GET`):** A versatile endpoint to fetch data.
    -   Accepts a `type` query parameter (e.g., `/api/data.php?type=pantries`).
    -   If `type=pantries`, `SELECT * FROM pantries WHERE deleted = 0`.
    -   If `type=politicians`, `SELECT * FROM politicians`.
    -   If `type=candidates`, `SELECT * FROM candidates WHERE show_on_map = 1`.
    -   Return the results as a JSON array.

2.  **`pantry.php` (`POST`):** Handles new pantry submissions.
    -   Accepts a JSON payload with all required pantry fields.
    -   Perform server-side validation.
    -   Use prepared statements to securely insert the data into the `pantries` table.
    -   Return the newly created pantry object with a `201 Created` status code.

3.  **`candidate.php` (`POST`):** Handles new candidate submissions.
    -   Accepts a JSON payload with candidate fields (name, country, state, office_type, website, phone, show_on_map).
    -   Geocode the location based on state/country to get lat/lng.
    -   Use prepared statements to securely insert data into the `candidates` table.
    -   Return the newly created candidate object with a `201 Created` status code.

4.  **`geocode.php` (`GET`):** Geocoding service proxy.
    -   Accepts an `address` or `location` (e.g., "Montana, USA") query parameter.
    -   Make a server-to-server request to OpenStreetMap Nominatim. Include a proper User-Agent header.
    -   Return a JSON object containing `{ lat, lng }`.

5.  **Cron Job Logic (Conceptual):**
    -   A daily cron job should run a PHP script that handles expiring pantry listings.
    -   `UPDATE pantries SET deleted = 1 WHERE repeating = 'one-time' AND created_at < DATE_SUB(NOW(), INTERVAL 1 WEEK);`
    -   `UPDATE pantries SET deleted = 1 WHERE repeating = 'idk' AND created_at < DATE_SUB(NOW(), INTERVAL 1 MONTH);`

---

### **Part 3: Frontend Structure (HTML & CSS)**

**1. Main Page (`index.html`):**
-   **Layout:** A centered, vertical layout with a dark gradient background (`bg-gradient-to-br from-background to-slate-900`).
-   **Buttons:** Two prominent buttons: "Find a Pantry" (blue background) and "#13UnionSupportV001" (secondary/gray background). These should be 50% smaller than standard large buttons.
-   **Map Preview:** Below the buttons, include a small `div` for a map preview (e.g., `w-full max-w-xs h-24`). This `div` should be non-interactive and have a semi-transparent overlay with text.
-   **Modal Trigger:** Clicks on the buttons or map preview trigger the main modal.

**2. Main Modal (Dynamically shown/hidden with JS):**
-   **Styling:** A large overlay (90vw width, 90vh height) with a dark background (`#0f172a`), light text, and rounded corners.
-   **Layout:** A two-column layout.
    -   **Left Column (Map):** Takes up 2/3 of the width for the Leaflet map.
    -   **Right Column (Controls):** Takes up 1/3 of the width, with a border. This is the control panel. **Crucially, this entire column must be vertically scrollable** if its content exceeds the viewport height. The scrolling should apply to the entire panel, not just parts of it.

**3. Styling (CSS):**
-   **Theme:** Dark theme with dark backgrounds, light text, and bright blue for primary actions.
-   **Golden Elements:** Use a bright gold color (`#FFD700`) for candidate-related UI elements (buttons, text) and a glowing effect. The "Running for Office?" button should use a brighter gold background (`#F1C40F`).
-   **Responsiveness:** The modal's columns should stack vertically on mobile.
-   **Leaflet Popups:** Custom `popup-dark` class for black background, white text popups.

---

### **Part 4: Frontend Logic (JavaScript)**

**1. Initialization:**
-   On page load, fetch initial pantry data and populate the preview map.
-   When the modal opens, fetch all data (`pantries`, `politicians`, `candidates`) and initialize the main interactive map.
-   **CRITICAL MAP FIX:** After the modal is displayed, the map must be explicitly resized using Leaflet's `invalidateSize()` method to ensure it renders correctly. A `setTimeout` is a reliable way to do this.

**2. Map Logic (Leaflet.js):**
-   **Initialization:** Create a Leaflet map instance centered on the USA.
-   **Marker Icons:** Create custom `L.Icon` instances for each marker type with distinct colors.
    -   Pantry (Food): Green, Clothing: Blue, Resource: Purple, Library: Black.
    -   Politician (House): Dark Gray, Politician (Senate): Black. There should be two black markers for each state's senators.
    -   Candidate: Gold (with a glowing CSS filter).
-   **Marker Rendering & Popups:**
    -   **Politician Popup:** Show name, office, state/district. Instead of "Status: Currently in office", show a clickable link to their Ballotpedia page (e.g., `https://ballotpedia.org/NAME`).
    -   **Candidate Popup:** Show name, office, state/district. The website link should always point to `https://uminion.com`.
-   **Filtering:** An `updateMapMarkers()` function re-renders markers based on selected categories and sub-filters (e.g., politician office type).

**3. Control Panel Logic:**
-   **View Switching:** Buttons toggle between "Find a Pantry", "Host a Pantry", and "Running for Office?" views.
-   **"Find a Pantry" View:**
    -   **Category Checkboxes:** Main categories for filtering.
    -   **Conditional Checkboxes:** When "Politicians..." is checked, show "Senator?" and "House of Representative?" checkboxes. When "Candidates..." is checked, show the same, but styled with bright gold text.
    -   **Scrolling:** The entire view, including category checkboxes and country/state lists, must scroll vertically within the main control panel's scroll container.
-   **"Host a Pantry" Form:**
    -   **AI Geo-Finder:** A "magic wand" button geocodes an address via `/api/geocode.php` and fills lat/lng fields.
    -   **Form Submission:** `POST` data to `/api/pantry.php`. On success, update the map.
-   **"Running for Office?" Form:**
    -   **Layout:** A new form triggered by a bright gold button.
    -   **Fields:** Name, Country, State, Office Type (checkbox grid), optional Website, optional Phone Number.
    -   **Map Marker Toggle:** A checkbox "Want a marker of you running; placed on the map?".
    -   **Form Submission:** `POST` data to `/api/candidate.php`. On success, show a link to the state's ballot access requirements (e.g., `https://ballotpedia.org/Ballot_access_for_major_and_minor_party_candidates_in_STATE_NAME`).
-   **"Pantry Details" View:**
    -   Shows detailed information for a selected pantry.

-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#ffffff" />
    <title>Instance app</title>
  </head>
  <body>
    <div id="root" class="contents"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
